<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <style>
        /* 스타일을 추가해 테두리를 꾸밀 수 있습니다. */
        .grid {
            display: grid;
            grid-template-columns: repeat(4, 50px);
            grid-template-rows: repeat(4, 50px);
            gap: 2px;
        }

        .cell {
            width: 50px;
            height: 50px;
            border: 1px solid black;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
            cursor: pointer;
        }

        #restart-button {
            margin-top: 10px;
            cursor: pointer;
        }
    </style>
</head>

<body>
    <div class="grid" id="grid"></div>
    <button id="restart-button">게임 재시작</button>

    <script>
        const grid = document.getElementById('grid');
        const restartButton = document.getElementById('restart-button');
        const size = 4; // 4x4 그리드
        let emptyCellIndex;
        let numbers;
        let gameStarted = false;

        // Fisher-Yates 셔플 함수
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        // 게임 초기화 함수
        function initializeGame() {
            numbers = Array.from({ length: 15 }, (_, index) => index + 1);
            numbers.push(''); // 숫자 0 대신 빈 문자열을 추가

            // 숫자 배열을 무작위로 섞습니다.
            shuffleArray(numbers);

            emptyCellIndex = numbers.indexOf(''); // 빈 칸의 초기 위치

            // 테두리가 있는 4x4 그리드를 생성합니다.
            numbers.forEach((number, index) => {
                const cell = document.createElement('div');
                cell.className = 'cell';
                cell.textContent = number;
                grid.appendChild(cell);
                cell.addEventListener('click', () => moveNumber(index));
            });

            gameStarted = true;
        }

        // 숫자를 이동시키는 함수
        function moveNumber(clickedIndex) {
            if (!gameStarted) {
                return; // 게임이 시작되지 않았으면 클릭 무시
            }

            const rowDiff = Math.floor(clickedIndex / size) - Math.floor(emptyCellIndex / size);
            const colDiff = clickedIndex % size - emptyCellIndex % size;

            if ((rowDiff === 0 && Math.abs(colDiff) === 1) || (colDiff === 0 && Math.abs(rowDiff) === 1)) {
                // 클릭한 셀과 빈 셀이 옆에 있는 경우
                const clickedCell = grid.children[clickedIndex];
                const emptyCellElement = grid.children[emptyCellIndex];

                // 클릭한 셀의 텍스트와 빈 셀의 텍스트를 교체합니다.
                const clickedText = clickedCell.textContent;
                clickedCell.textContent = '';
                emptyCellElement.textContent = clickedText;

                emptyCellIndex = clickedIndex;
            }

            // 퍼즐이 완료되었는지 확인합니다.
            checkWin();
        }

        // 퍼즐이 완료되었는지 확인하는 함수
        function checkWin() {
            const cells = Array.from(grid.children);
            const isWin = cells.every((cell, index) => {
                const cellValue = cell.textContent;
                return !cellValue || cellValue == index + 1;
            });

            if (isWin) {
                const restart = confirm('축하합니다! 퍼즐을 완료했습니다. 게임을 다시 시작하시겠습니까?');
                if (restart) {
                    // 게임 다시 시작
                    grid.innerHTML = '';
                    gameStarted = false;
                    initializeGame();
                }
            }
        }

        // 게임 재시작 버튼 클릭 시 초기화 함수 호출
        restartButton.addEventListener('click', () => {
            grid.innerHTML = '';
            gameStarted = false;
            initializeGame();
        });

        // 페이지 로드 시 게임 초기화 함수 호출
        initializeGame();
    </script>
</body>

</html>